<Project>

    <!-- Références aux DLLs interop (évaluées après le .csproj) -->
    <ItemGroup Condition="'$(EnoUnityLoaderMod)' == 'true'">
        <Reference Include="$(InteropDirectoryPath)\*.dll"/>
    </ItemGroup>

    <PropertyGroup>
        <!-- Chemin du fichier généré -->
        <GeneratedVersionFile>$(IntermediateOutputPath)ModData.g.cs</GeneratedVersionFile>
    </PropertyGroup>

    <!-- Génération automatique de la classe AssemblyVersion -->
    <Target Name="GenerateModDataClass" BeforeTargets="CoreCompile" Condition="'$(Version)' != '' AND '$(EnoUnityLoaderMod)' == 'true'">
        <PropertyGroup>
            <GeneratedVersionContent><![CDATA[// <auto-generated/>
namespace $(RootNamespace)%3B

internal static class ModData
{
    public const string Guid = "$(AssemblyGuid)"%3B
    public const string Name = "$(AssemblyName)"%3B
    public const string Version = "$(Version)"%3B
}
]]></GeneratedVersionContent>
        </PropertyGroup>

        <WriteLinesToFile File="$(GeneratedVersionFile)"
                          Lines="$(GeneratedVersionContent)"
                          Overwrite="true"
                          WriteOnlyWhenDifferent="true"/>

        <ItemGroup>
            <!-- Remove first to avoid duplicates, then add -->
            <Compile Remove="$(GeneratedVersionFile)"/>
            <Compile Include="$(GeneratedVersionFile)"/>
        </ItemGroup>
    </Target>

    <!-- Import copy to core target for all projects -->
    <Import Project="$(MSBuildThisFileDirectory)build\CopyToGameFiles.targets"/>

</Project>
